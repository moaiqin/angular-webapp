"use strict";angular.module("app",["ui.router","ngCookies","validation"]),angular.module("app").controller("companyCtrl",["$scope","companyServer","$state",function(e,t,r){var n=r.params.id;t.getCompanyMsg(n).then(function(t){e.comMsg=t})}]),angular.module("app").controller("loginCtrl",["$scope","userServer","$state","cacheServer",function(e,t,r,n){e.submit=function(){t.login(e.user).then(function(e){e.id&&r.go("user")})}}]),angular.module("app").controller("mainCtrl",["$scope","$http","mainServer","$state","userServer",function(e,t,r,n,o){e.logined=!1,o.checkLogined()?e.logined=!0:e.logined=!1,e.handelClick=function(){e.logined?(o.logout(),n.go("login")):n.go("login")},r.getPositionList().then(function(t){t.length&&(e.positionList=t)})}]),angular.module("app").controller("positionCtrl",["$scope","$state","positionServer","companyServer","userServer",function(e,t,r,n,o){var a=t.params.id;o.checkLogined()?e.logined=!0:e.logined=!1,r.getPositionMsg(a).then(function(t){e.positionData=t,n.getCompanyMsg(t.companyId).then(function(t){e.companyMsg=t})})}]),angular.module("app").controller("postCtrl",["$scope","userServer","$state",function(e,t,r){t.checkLogined()||$state.go("login"),e.tabList=[{id:"all",name:"全部"},{id:"past",name:"邀请面试"},{id:"fail",name:"不合格"}],t.post().then(function(t){e.positionList=t,console.log(t)}),e.filterObj={},e.tClick=function(t){switch(t){case"all":delete e.filterObj.status;break;case"past":e.filterObj.status="1";break;case"fail":e.filterObj.status="-1"}}}]),angular.module("app").controller("registerCtrl",["$scope","$http","$interval","userServer","$state",function(e,t,r,n,o){var a=!1;e.getCode=function(){a||(a=!0,n.getCode().then(function(t){if(t.state){var n=60;e.time=n+"s重新获取";var o=r(function(){if(--n<1)return r.cancel(o),e.time="",void(a=!1);e.time=n+"s重新获取"},1e3)}}))},e.submit=function(){n.register(e.user).then(function(e){e&&o.go("login")})}}]),angular.module("app").controller("searchCtrl",["$scope","mainServer","dict","$filter",function(e,t,r,n){var o="";e.sheet={},e.filterObj={},e.searchValue="",e.searchTabList=[{id:"city",name:"城市"},{id:"salary",name:"工资"},{id:"scale",name:"公司规模"}],t.getPositionList().then(function(t){t.length&&(e.positionList=t,e.listSearchCopy=t)}),e.tClick=function(t,n){o=t,e.sheet.data=r[t],e.sheet.visibly=!0},e.sClick=function(t,r){t?(e.filterObj[o+"Id"]=t,angular.forEach(e.searchTabList,function(e){o===e.id&&(e.name=r)})):(delete e.filterObj[o+"Id"],angular.forEach(e.searchTabList,function(e){if(o===e.id)switch(e.id){case"city":e.name="城市";break;case"salary":e.name="工资";break;case"scale":e.name="公司规模"}}))},e.searchData=function(t){e.searchValue&&(e.positionList=n("searchFilter")(e.listSearchCopy,e.searchValue))},e.searchCancel=function(){alert(1)}}]),angular.module("app").controller("storeCtrl",["$scope","userServer","$state",function(e,t,r){t.checkLogined()||r.go("login"),t.getStore().then(function(t){e.positionList=t})}]),angular.module("app").controller("userCtrl",["$scope","cacheServer","userServer","$state",function(e,t,r,n){r.checkLogined()||n.go("login"),e.image=t.get("imageUrl"),e.username=t.get("username"),e.userId=t.get("id"),e.logout=function(){r.logout(),n.go("login")}}]),angular.module("app").directive("appLogin",function(){return{restrict:"A",replace:!0,templateUrl:"view/template/appLogin.html"}}),angular.module("app").directive("appPositionDesc",[function(){return{restrict:"A",templateUrl:"view/template/appPositionDesc.html",replace:!0,scope:{data:"=",com:"="}}}]),angular.module("app").directive("appRegister",[function(){return{restrict:"A",templateUrl:"view/template/register.html",replace:!0}}]),angular.module("app").directive("company",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/company.html",scope:{com:"="}}}]),angular.module("app").directive("appCompanyClass",["$state",function(e){return{restrict:"A",replace:!0,scope:{com:"="},templateUrl:"view/template/companyClass.html",link:function(e){e.doPositionList=function(t){e.positionList=e.com.positionClass[t].positionList,e.isActive=t},e.$watch("com",function(t,r){t&&e.doPositionList(0)},!0)}}}]),angular.module("app").directive("appFooter",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/footer.html"}}]),angular.module("app").directive("appHeader",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/header.html"}}]),angular.module("app").directive("appPositionHeader",["$state",function(e){return{restrict:"A",templateUrl:"view/template/positionHeader.html",replace:!0,scope:{text:"@",router:"@"},link:function(t,r,n){t.back=function(){t.router?e.go(t.router):window.history.back()}}}}]),angular.module("app").directive("appPositionList",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/positionList.html",scope:{data:"=",filterObj:"=",store:"="}}}]),angular.module("app").directive("searchSheet",function(){return{restrict:"A",replace:!0,templateUrl:"view/template/searchSheet.html",scope:{data:"=",visibly:"=",changeValue:"&"}}}),angular.module("app").directive("searchTab",function(){return{restrict:"A",replace:!0,scope:{searchTabList:"=",tClick:"&"},templateUrl:"view/template/searchTab.html",link:function(e){e.tabClick=function(t){e.selectedId=t.id,e.tClick(t)}}}}),angular.module("app").value("dict",{}).run(["dict","$http",function(e,t){t.get("/data/city.json").then(function(t){e.city=t.data},function(e){console.log("city server err: "+e)}),t.get("/data/salary.json").then(function(t){e.salary=t.data},function(e){console.log("saraly server err:"+e)}),t.get("/data/scale.json").then(function(t){e.scale=t.data},function(e){console.log("saraly server err:"+e)})}]),angular.module("app").config(["$provide",function(e){e.decorator("$http",["$delegate","$q",function(e,t){return e.post=function(t,r,n){return e.get(t,r)},e}])}]),angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){r.hashPrefix(""),e.state("main",{url:"/main",templateUrl:"view/main.html",controller:"mainCtrl"}).state("position",{url:"/position/:id",templateUrl:"view/position.html",controller:"positionCtrl"}).state("company",{url:"/positionclass/:id",templateUrl:"view/positionClass.html",controller:"companyCtrl"}).state("search",{url:"/search",templateUrl:"view/search.html",controller:"searchCtrl"}).state("login",{url:"/login",templateUrl:"view/login.html",controller:"loginCtrl"}).state("register",{url:"/register",templateUrl:"view/register.html",controller:"registerCtrl"}).state("user",{url:"/user",templateUrl:"view/user.html",controller:"userCtrl"}).state("store",{url:"/store",templateUrl:"view/store.html",controller:"storeCtrl"}).state("post",{url:"/post",templateUrl:"view/post.html",controller:"postCtrl"}),t.otherwise("main")}]),angular.module("app").config(["$validationProvider",function(e){var t={phone:/^1[\d]{10}/,password:function(e){return e>5}},r={phone:{success:"",error:"必须是11位号码"},password:{error:"大于6位的密码"}};e.setExpression(t).setDefaultMsg(r)}]),angular.module("app").filter("filterByObj",[function(){return function(e,t){var r=[];return angular.forEach(e,function(e,n){var o=!0;for(var a in t)e[a]!==t[a]&&(o=!1);o&&r.push(e)}),r}}]),angular.module("app").filter("searchFilter",[function(){return function(e,t){var r=[],n=new RegExp(t,"g");return angular.forEach(e,function(e){var t=!1;for(var o in e)switch(o){case"cityName":case"companyName":case"job":n.test(e[o])&&(t=!0)}t&&r.push(e)}),r}}]),angular.module("app").service("cacheServer",["$cookies",function(e){this.put=function(t,r){e.put(t,r)},this.remove=function(t){e.remove(t)},this.get=function(t){return e.get(t)}}]),angular.module("app").service("companyServer",["$http",function(e){this.getCompanyMsg=function(t){return e.get("/data/company.json?id="+t).then(function(e){return e.data},function(e){console.log("server err:"+e)})}}]),angular.module("app").service("mainServer",["$http",function(e){this.getPositionList=function(){return e.get("/data/positionList.json").then(function(e){if("OK"===e.statusText)return e.data},function(e){console.log("server err:"+e)})}}]),angular.module("app").factory("positionServer",["$http",function(e){var t={};return t.getPositionMsg=function(t){return e.get("/data/position.json").then(function(e){return e.data},function(e){console.log("server err:"+e)})},t}]),angular.module("app").factory("userServer",["$http","cacheServer","$state",function(e,t,r){var n={};return n.getCode=function(){return e.get("data/code.json").then(function(e){return e.data},function(e){console.log("code server error")})},n.data={},n.login=function(r){return e.post("data/login.json",r).then(function(e){return e.data.id&&(n.data=e.data,t.put("username",e.data.name),t.put("imageUrl",e.data.image),t.put("userId",e.data.id)),e.data},function(e){console.log(e)})},n.logout=function(){t.remove("username"),t.remove("imageUrl"),t.remove("id")},n.checkLogined=function(){var e=t.get("userId"),r=t.get("username");return!(!e||!r)},n.register=function(t){return e.post("data/regist.json",t).then(function(e){return!!e.data.id&&e.data.id},function(){})},n.post=function(){var n=t.get("userId"),o={id:n};return n||r.go("login"),e.get("data/myPost.json",o).then(function(e){return e.data},function(e){console.log(e)})},n.getStore=function(){var n=t.get("userId"),o={id:n};return n||r.go("login"),e.get("data/myFavorite.json",o).then(function(e){return e.data},function(e){console.log(e)})},n}]);